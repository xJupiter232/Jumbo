<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulator Jumbo</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    main { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; }
    .sekcja { margin-bottom: 20px; }
    label { font-weight: bold; display: block; margin-bottom: 5px; }
    input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { width: 100%; padding: 10px; margin: 5px 0; border: none; border-radius: 5px; background: #007bff; color: white; font-size: 16px; cursor: pointer; }
    button:hover { background: #0056b3; }
    #wynik { margin-top: 20px; padding: 15px; border-radius: 5px; font-weight: bold; }
    #historia { margin-top: 20px; padding: 15px; background: #eef; border-radius: 5px; }
    #listaOrderow { margin-top: 10px; padding: 10px; background: #eef; border-radius: 5px; display: none; }
    .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 16px; position: fixed; z-index: 1; left: 50%; bottom: 30px; transform: translateX(-50%); }
    .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
    @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
    @keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
  </style>
</head>
<body>

<main>
  <h1>Kalkulator Jumbo</h1>

  <div class="sekcja">
    <label for="nowyOrder">Dodaj order:</label>
    <input type="tel" id="nowyOrder" placeholder="np. 124">
    <button onclick="dodajOrder(1)">Dodaj order (sekcja 1)</button>
    <button onclick="dodajOrder(2)">Dodaj order (sekcja 2)</button>
    <button onclick="usunOstatniOrder()" style="background:#dc3545;">UsuÅ„ order</button>
    <div id="listaOrderow"></div>
  </div>

  <div class="sekcja">
    <label for="czas">Czas pracy (w godzinach):</label>
    <input id="czas" type="text" placeholder="np. 2,5">
  </div>

  <button onclick="oblicz()">Oblicz produktywnoÅ›Ä‡</button>
  <button onclick="wyczyscDane()" style="background:#ffc107;">WyczyÅ›Ä‡ dane</button>
  <button onclick="usunHistorie()" style="background:#dc3545;">UsuÅ„ historiÄ™</button>
  <button onclick="kopiujHistorie()" style="background:#28a745;">Kopiuj historiÄ™</button>

  <div id="wynik"></div>
  <div id="historia"></div>
</main>

<div id="powiadomienie" class="toast"></div>

<script>
let orderyWszystkie = [];
let historiaList = [];

function pokazPowiadomienie(tresc) {
  const x = document.getElementById("powiadomienie");
  x.innerText = tresc;
  x.className = "toast show";
  setTimeout(() => x.className = x.className.replace("show", ""), 3000);
}

function dodajOrder(sekcja) {
  let wartosc = document.getElementById("nowyOrder").value.trim();
  if (!wartosc) return pokazPowiadomienie("Wpisz numer orderu.");

  wartosc = parseFloat(wartosc.replace(",", "."));
  if (isNaN(wartosc) || wartosc <= 0) return pokazPowiadomienie("Wpisz poprawny numer orderu wiÄ™kszy niÅ¼ 0.");

  orderyWszystkie.push({ wartosc, sekcja });
  document.getElementById("nowyOrder").value = "";
  pokazListeOrderow();
}

function usunOstatniOrder() {
  if (orderyWszystkie.length === 0) return pokazPowiadomienie("Brak orderÃ³w do usuniÄ™cia.");
  orderyWszystkie.pop();
  pokazListeOrderow();
}

function pokazListeOrderow() {
  const div = document.getElementById("listaOrderow");
  if (orderyWszystkie.length === 0) {
    div.style.display = "none";
    div.innerHTML = "";
    return;
  }

  const posortowane = [...orderyWszystkie].sort((a, b) => a.sekcja - b.sekcja);
  const suma = posortowane.reduce((a, b) => a + b.wartosc, 0);
  const sekcja1Lista = posortowane.filter(o => o.sekcja === 1).map(o => o.wartosc);
  const sekcja2Lista = posortowane.filter(o => o.sekcja === 2).map(o => o.wartosc);

  div.style.display = "block";
  let html = `<strong>ðŸ“¦ Ordery:</strong><br>`;

  if (sekcja1Lista.length > 0)
    html += `<strong>Sekcja 1:</strong> ${sekcja1Lista.join(", ")}<br>`;

  if (sekcja2Lista.length > 0)
    html += `<strong>Sekcja 2:</strong> ${sekcja2Lista.join(", ")}<br>`;

  html += `<strong>ðŸ”¢ Suma:</strong> ${suma}`;
  div.innerHTML = html;
}

function oblicz() {
  const czas = parseFloat(document.getElementById("czas").value.replace(",", "."));
  if (isNaN(czas) || czas <= 0) return pokazPowiadomienie("Wpisz poprawny czas pracy.");
  if (orderyWszystkie.length === 0) return pokazPowiadomienie("Dodaj przynajmniej jeden order.");

  const suma1 = orderyWszystkie.filter(o => o.sekcja === 1).reduce((a,b)=>a+b.wartosc,0);
  const suma2 = orderyWszystkie.filter(o => o.sekcja === 2).reduce((a,b)=>a+b.wartosc,0);
  const suma = suma1 + suma2;

  const normaLaczna = ((suma1 * 189) + (suma2 * 197)) / suma;
  const produktywnosc = suma / czas;
  const procent = (produktywnosc / normaLaczna) * 100;

  const wynikDiv = document.getElementById("wynik");
  wynikDiv.innerHTML =
    `Suma orderÃ³w: ${suma}<br>` +
    `Czas pracy: ${czas}h<br>` +
    `ProduktywnoÅ›Ä‡: ${produktywnosc.toFixed(2)} ord/h<br>` +
    `Realizacja normy: ${procent.toFixed(2)}%`;

  wynikDiv.style.background =
    procent >= 100 ? "#c8e6c9" : procent >= 90 ? "#fff3cd" : "#f8d7da";

  dodajDoHistorii(suma1, suma2, czas, suma, produktywnosc, procent);
}

function dodajDoHistorii(s1, s2, czas, suma, prod, proc) {
  const wpis = `ðŸ“… ${new Date().toLocaleString("pl-PL")}
Suma: ${suma}, czas: ${czas}h
ProduktywnoÅ›Ä‡: ${prod.toFixed(2)} ord/h (${proc.toFixed(2)}%)
Sekcja 1: ${orderyWszystkie.filter(o=>o.sekcja===1).map(o=>o.wartosc).join(", ")}
Sekcja 2: ${orderyWszystkie.filter(o=>o.sekcja===2).map(o=>o.wartosc).join(", ")}`;

  historiaList.push(wpis);
  localStorage.setItem("jumboHistoria", JSON.stringify(historiaList));
  pokazHistorie();
}

function pokazHistorie() {
  const div = document.getElementById("historia");
  if (historiaList.length === 0) { div.innerHTML = ""; return; }
  div.innerHTML = `<h3>Historia obliczeÅ„:</h3><ul>` + historiaList.map(h=>`<li>${h.replace(/\n/g,"<br>")}</li>`).join("") + "</ul>";
}

function wyczyscDane() {
  orderyWszystkie = [];
  dokument.getElementById
  pokazListeOrderow();
  pokazPowiadomienie("Wyczyszczono dane.");
}

function kopiujHistorie() {
  if (historiaList.length === 0) return pokazPowiadomienie("Brak historii do kopiowania.");
  navigator.clipboard.writeText(historiaList.join("\n\n"));
  pokazPowiadomienie("Skopiowano historiÄ™!");
}

function usunHistorie() {
  historiaList = [];
  localStorage.removeItem("jumboHistoria");
  pokazHistorie();
  pokazPowiadomienie("Historia usuniÄ™ta.");
}

// Wczytywanie historii
const h = localStorage.getItem("jumboHistoria");
if (h) historiaList = JSON.parse(h);
pokazHistorie();
</script>

</body>
</html>
