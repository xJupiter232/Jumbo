<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Kalkulator Jumbo</title>

  <!-- PWA metatagi -->
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Kalkulator Jumbo" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
      max-width: 480px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 15px;
      background-color: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #005bb5;
    }
    .przyciski-order {
      display: flex;
      gap: 10px;
    }
    .przyciski-order button {
      flex: 1;
    }
    #listaOrderow, #wynik, #historia {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      display: none;
    }
    #powiadomienie {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #007aff;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1000;
      text-align: center;
      animation: fadein 0.3s ease, fadeout 0.3s ease 2.7s;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    @keyframes fadeout {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>
  <main>
    <h1>üì¶ Kalkulator Jumbo</h1>

    <section id="formularz">
      <label for="norma">Norma (order√≥w/godzinƒô):</label>
      <input type="tel" id="norma" value="189" inputmode="numeric" pattern="[0-9]*" />

      <label for="nowyOrder">Dodaj order:</label>
      <input type="tel" id="nowyOrder" placeholder="np. 124" inputmode="numeric" pattern="[0-9]*" />

      <div class="przyciski-order">
        <button onclick="dodajOrder()">Dodaj order</button>
        <button onclick="usunOstatniOrder()">Usu≈Ñ order</button>
      </div>

      <div id="listaOrderow"></div>

      <label for="czas">Czas pracy (w godzinach):</label>
      <input type="tel" id="czas" placeholder="np. 2,5" inputmode="decimal" />

      <button onclick="oblicz()">Oblicz produktywno≈õƒá</button>
      <button onclick="wyczysc()">Wyczy≈õƒá dane</button>
      <button onclick="usunHistorie()">Usu≈Ñ historiƒô</button>
      <button onclick="kopiujHistorie()">Kopiuj historiƒô</button>
    </section>

    <section id="wynik"></section>
    <section id="historia"></section>
  </main>
  <div id="powiadomienie" style="display:none;"></div>

  <script>
    let ordery = [];
    let historiaList = [];

    window.onload = () => {
      const saved = localStorage.getItem("jumboHistoria");
      if (saved) {
        historiaList = JSON.parse(saved);
        pokazHistorie();
      }
    };

    function pokazPowiadomienie(tresc) {
      const div = document.getElementById("powiadomienie");
      div.textContent = tresc;
      div.style.display = "block";
      div.style.animation = "none";
      div.offsetHeight; // reset animacji
      div.style.animation = "fadein 0.3s ease, fadeout 0.3s ease 2.7s";
      setTimeout(() => div.style.display = "none", 3000);
    }

    function dodajOrder() {
      const input = document.getElementById("nowyOrder");
      const wartosc = parseFloat(input.value.trim().replace(",", "."));
      if (!isNaN(wartosc) && wartosc > 0) {
        ordery.push(wartosc);
        input.value = "";
        pokazListeOrderow();
      } else {
        pokazPowiadomienie("Wpisz poprawny numer orderu wiƒôkszy ni≈º 0.");
      }
    }

    function usunOstatniOrder() {
      if (ordery.length === 0) {
        pokazPowiadomienie("Brak order√≥w do usuniƒôcia.");
        return;
      }
      ordery.pop();
      pokazListeOrderow();
    }

    function pokazListeOrderow() {
      const div = document.getElementById("listaOrderow");
      if (ordery.length === 0) {
        div.style.display = "none";
        div.innerHTML = "";
        return;
      }
      const suma = ordery.reduce((a, b) => a + b, 0);
      div.style.display = "block";
      div.innerHTML = `<strong>üì¶ Ordery:</strong> ${ordery.join(", ")}<br><strong>üî¢ Suma:</strong> ${suma}`;
    }

    function oblicz() {
      const norma = parseFloat(document.getElementById("norma").value.replace(",", "."));
      const czas = parseFloat(document.getElementById("czas").value.replace(",", "."));

      if (isNaN(norma) || norma <= 0) {
        pokazPowiadomienie("Wpisz poprawnƒÖ warto≈õƒá normy.");
        return;
      }
      if (isNaN(czas) || czas <= 0) {
        pokazPowiadomienie("Wpisz poprawny czas pracy.");
        return;
      }
      if (ordery.length === 0) {
        pokazPowiadomienie("Dodaj przynajmniej jeden order.");
        return;
      }

      const suma = ordery.reduce((a, b) => a + b, 0);
      const produktywnosc = suma / czas;
      const procent = (produktywnosc / norma) * 100;

      const wynikDiv = document.getElementById("wynik");
      wynikDiv.style.display = "block";
      wynikDiv.style.backgroundColor =
        procent >= 100 ? "#d4edda" : procent >= 90 ? "#fff3cd" : "#f8d7da";

      wynikDiv.innerHTML = `
        üî¢ <strong>Suma order√≥w:</strong> ${suma}<br>
        ‚è±Ô∏è <strong>Produktywno≈õƒá:</strong> ${produktywnosc.toFixed(2)} ord/h<br>
        üéØ <strong>Realizacja normy:</strong> ${procent.toFixed(1)}%
      `;

      const teraz = new Date();
      const data = teraz.toLocaleDateString("pl-PL");
      const godzina = teraz.toLocaleTimeString("pl-PL", { hour: "2-digit", minute: "2-digit" });
      const zapis = `‚úÖ ${data} ${godzina} ‚Äî ${suma} order√≥w w ${czas}h ‚Üí ${produktywnosc.toFixed(2)} ord/h (${procent.toFixed(1)}%)<br>üì¶ Ordery: ${ordery.join(", ")}`;
      historiaList.unshift(zapis);
      try {
        localStorage.setItem("jumboHistoria", JSON.stringify(historiaList));
      } catch (e) {
        console.warn("Nie uda≈Ço siƒô zapisaƒá historii:", e);
      }
      pokazHistorie();
    }

    function pokazHistorie() {
      const historiaDiv = document.getElementById("historia");
      historiaDiv.style.display = "block";
      historiaDiv.innerHTML = "<strong>üìú Historia oblicze≈Ñ:</strong><ul>" +
        historiaList.map(e => `<li>${e}</li>`).join("") +
        "</ul>";
    }

    function wyczysc() {
      ordery = [];
      document.getElementById("nowyOrder").value = "";
      document.getElementById("czas").value = "";
      document.getElementById("listaOrderow").style.display = "none";
      document.getElementById("wynik").style.display = "none";
    }

    function usunHistorie() {
      historiaList = [];
      localStorage.removeItem("jumboHistoria");
      document.getElementById("historia").style.display = "none";
    }

    function kopiujHistorie() {
  if (historiaList.length === 0) {
    pokazPowiadomienie("Brak historii do skopiowania.");
    return;
  }
  const tekst = historiaList
    .map(e => e.replace(/<br>/g, "
"))  // zamiana <br> na nowƒÖ liniƒô
    .join("

");
  navigator.clipboard.writeText(tekst).then(() => {
    pokazPowiadomienie("Historia zosta≈Ça skopiowana do schowka.");
  });
}
      const tekst = historiaList.join("\\n\\n");
      navigator.clipboard.writeText(tekst).then(() => {
        pokazPowiadomienie("Historia zosta≈Ça skopiowana do schowka.");
      });
    }
  </script>

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("‚úÖ Service Worker zarejestrowany!"))
      .catch(err => console.error("‚ùå B≈ÇƒÖd rejestracji SW:", err));
  });
}
</script>
</body>

</html>
